// VirtualBox Configuration with Own Disks for Root, Home and Swap
// Copyright (C) 2020-2021 by Thomas Dreibholz
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
//
// Contact: dreibh@simula.no

{
  "vm_name": "{{user `vm_name`}}",
  "output_directory": "{{user `vm_directory`}}",
  "type": "virtualbox-iso",
  "guest_additions_mode": "disable",
  "guest_os_type": "Ubuntu_64",
  "headless": true,
  "format": "ova",
  "export_opts": [
    "--ovf10",
    "--manifest",
    "--vsys", "0",
    "--description", "{{user `vm_description`}}",
    "--version",     "{{user `vm_version`}}",
    "--vendor",      "{{user `vm_vendor`}}",
    "--vendorurl",   "{{user `vm_vendorurl`}}",
    "--product",     "{{user `vm_product`}}",
    "--producturl",  "{{user `vm_producturl`}}"
  ],
  "chipset": "ich9",
  "firmware": "efi",
  "nic_type": "virtio",
  "gfx_controller": "vmsvga",
  "audio_controller": "hda",
  "iso_interface": "virtio",
  "hard_drive_interface": "virtio",
  "hard_drive_discard": true,
  "hard_drive_nonrotational": true,
  "keep_registered": true,

  "cpus": "{{user `vm_cores`}}",
  "memory": "{{user `vm_memory`}}",
  "disk_size": "{{user `vm_disk_root`}}",
  // !!! "disk_additional_size": [
  // !!!   "{{user `vm_disk_home`}}",
  // !!!   "{{user `vm_disk_swap`}}"
  // !!! ],
  "sound": "pulse",
  "vboxmanage": [
    [ "modifyvm", "{{.Name}}", "--nested-hw-virt", "off" ],
    [ "modifyvm", "{{.Name}}", "--rtcuseutc", "on" ],
    [ "modifyvm", "{{.Name}}", "--vram", "128" ],
    [ "modifyvm", "{{.Name}}", "--vrde", "off" ],
    [ "modifyvm", "{{.Name}}", "--accelerate3d", "off" ],
    [ "setextradata", "global", "GUI/SuppressMessages", "all" ],
    [ "setextradata", "{{.Name}}", "VBoxInternal2/EfiGraphicsResolution", "{{user `vm_video`}}" ],

    // ====== Add additional disks ==========================================
    [ "createhd", "--format", "VDI", "--filename", "{{user `vm_directory`}}/{{.Name}}-Home.vdi", "--variant", "Standard", "--size", "{{user `vm_disk_home`}}" ],
    [ "createhd", "--format", "VDI", "--filename", "{{user `vm_directory`}}/{{.Name}}-Swap.vdi", "--variant", "Standard", "--size", "{{user `vm_disk_swap`}}" ],
    [ "storageattach", "{{.Name}}", "--storagectl", "VirtIO Controller", "--port", "2", "--type", "hdd",
      "--medium", "{{user `vm_directory`}}/{{.Name}}-Home.vdi", "--nonrotational", "on", "--discard", "on" ],
    [ "storageattach", "{{.Name}}", "--storagectl", "VirtIO Controller", "--port", "3", "--type", "hdd",
      "--medium", "{{user `vm_directory`}}/{{.Name}}-Swap.vdi", "--nonrotational", "on", "--discard", "on" ]
    // ======================================================================

  ]
}
